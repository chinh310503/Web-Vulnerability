# Business logic vulnerabilities

## Business logic vulnerabilities là gì

Các lỗ hổng logic là những sai sót trong thiết kế và triển khai ứng dụng cho phép kẻ tấn công thực hiện hành vi ngoài ý muốn. Điều này có khả năng cho phép kẻ tấn công thao túng chức năng hợp pháp để đạt được mục tiêu độc hại. Những sai sót này thường là kết quả của việc không lường trước được các trạng thái ứng dụng bất thường có thể xảy ra và do đó không xử lý chúng một cách an toàn.

Các lỗ hổng logic thường không hiển thị đối với những người không tìm kiếm chúng một cách rõ ràng vì chúng thường không bị lộ ra khi sử dụng ứng dụng thông thường. Tuy nhiên, kẻ tấn công có thể khai thác các hành vi kỳ quặc bằng cách tương tác với ứng dụng theo những cách mà nhà phát triển không bao giờ có ý định.

Một trong những mục đích chính của logic nghiệp vụ là thực thi các quy tắc và ràng buộc đã được xác định khi thiết kế ứng dụng hoặc chức năng. Nói rộng hơn, các quy tắc nghiệp vụ chỉ ra cách ứng dụng sẽ phản ứng khi một tình huống nhất định xảy ra. Điều này bao gồm việc ngăn người dùng làm những việc sẽ có tác động tiêu cực đến doanh nghiệp hoặc đơn giản là không có ý nghĩa.

Các lỗ hổng trong logic có thể cho phép kẻ tấn công phá vỡ các quy tắc này. Ví dụ: họ có thể hoàn tất giao dịch mà không cần thực hiện quy trình mua hàng dự kiến. Trong các trường hợp khác, việc xác thực dữ liệu do người dùng cung cấp bị hỏng hoặc không tồn tại có thể cho phép người dùng thực hiện các thay đổi tùy ý đối với các giá trị quan trọng trong giao dịch hoặc gửi thông tin đầu vào vô nghĩa. Bằng cách chuyển các giá trị không mong muốn vào logic phía máy chủ, kẻ tấn công có thể khiến ứng dụng thực hiện điều gì đó mà nó không được phép làm.

Các lỗ hổng dựa trên logic có thể cực kỳ đa dạng và thường chỉ dành riêng cho ứng dụng cũng như chức năng cụ thể của nó. Việc xác định chúng thường đòi hỏi một lượng kiến ​​thức nhất định của con người, chẳng hạn như sự hiểu biết về lĩnh vực kinh doanh hoặc mục tiêu mà kẻ tấn công có thể có trong một bối cảnh nhất định. Điều này khiến chúng khó bị phát hiện bằng cách sử dụng máy quét lỗ hổng tự động. Do đó, các lỗ hổng logic là mục tiêu tuyệt vời cho những người săn lỗi và người kiểm tra thủ công nói chung.

## Business logic vulnerabilities phát sinh như thế nào

Các lỗ hổng logic nghiệp vụ thường phát sinh do nhóm thiết kế và phát triển đưa ra các giả định sai lầm về cách người dùng sẽ tương tác với ứng dụng. Những giả định xấu này có thể dẫn đến việc xác thực đầu vào của người dùng không đầy đủ. Ví dụ: nếu nhà phát triển cho rằng người dùng sẽ truyền dữ liệu độc quyền qua trình duyệt web thì ứng dụng có thể dựa hoàn toàn vào các biện pháp kiểm soát yếu kém phía máy khách để xác thực dữ liệu đầu vào. Những kẻ tấn công này có thể dễ dàng vượt qua chúng bằng cách sử dụng proxy chặn.

Cuối cùng, điều này có nghĩa là khi kẻ tấn công đi chệch khỏi hành vi mong đợi của người dùng, ứng dụng sẽ không thực hiện các bước thích hợp để ngăn chặn điều này và sau đó không xử lý tình huống một cách an toàn.

Các lỗi logic đặc biệt phổ biến trong các hệ thống quá phức tạp mà ngay cả nhóm phát triển cũng không hiểu hết. Để tránh các lỗi logic, các nhà phát triển cần hiểu toàn bộ ứng dụng. Điều này bao gồm việc nhận thức được cách các chức năng khác nhau có thể được kết hợp theo những cách không ngờ tới. Các nhà phát triển làm việc trên cơ sở mã lớn có thể không hiểu rõ về cách hoạt động của tất cả các lĩnh vực của ứng dụng. Ai đó làm việc trên một thành phần có thể đưa ra các giả định sai sót về cách hoạt động của thành phần khác và kết quả là vô tình gây ra các lỗi logic nghiêm trọng. Nếu các nhà phát triển không ghi lại rõ ràng bất kỳ giả định nào đang được đưa ra thì các loại lỗ hổng này rất dễ xâm nhập vào ứng dụng.

## Tác động của Business logic vulnerabilities

Đôi khi, tác động của các lỗ hổng logic nghiệp vụ có thể khá nhỏ. Đây là một phạm trù rộng và tác động rất khác nhau. Tuy nhiên, bất kỳ hành vi ngoài ý muốn nào cũng có thể dẫn đến các cuộc tấn công có mức độ nghiêm trọng cao nếu kẻ tấn công có thể thao túng ứng dụng đúng cách. Vì lý do này, logic kỳ quặc lý tưởng nhất là nên được sửa ngay cả khi bạn không thể tự mình tìm ra cách khai thác nó. Luôn có rủi ro mà người khác có thể làm được.

Về cơ bản, tác động của bất kỳ lỗi logic nào phụ thuộc vào chức năng mà nó liên quan đến. Ví dụ, nếu lỗi nằm trong cơ chế xác thực, điều này có thể ảnh hưởng nghiêm trọng đến bảo mật tổng thể của bạn. Kẻ tấn công có khả năng khai thác điều này để leo thang đặc quyền hoặc bỏ qua hoàn toàn xác thực, truy cập vào dữ liệu và chức năng nhạy cảm. Điều này cũng làm tăng bề mặt tấn công cho các khai thác khác.

Logic thiếu sót trong các giao dịch tài chính rõ ràng có thể dẫn đến tổn thất lớn cho doanh nghiệp do bị đánh cắp tiền, gian lận, v.v.

## Một số ví dụ về Business logic vulnerabilities

- Tin tưởng quá mức vào các biện pháp kiểm soát phía khách hàng
- Không xử lý được đầu vào bất thường
- Đưa ra các giả định sai lầm về hành vi của người dùng
- Lỗi dành riêng với các lĩnh vực
- Cung cấp một mã hóa và giải mã của mã hóa đó cho người dùng

## Cách phòng ngừa

Chìa khóa để ngăn chặn các lỗ hổng logic nghiệp vụ là:

- Đảm bảo nhà phát triển và người thử nghiệm hiểu miền mà ứng dụng phục vụ
- Tránh đưa ra các giả định ngầm về hành vi của người dùng hoặc hành vi của các phần khác của ứng dụng

Bạn nên xác định những giả định nào bạn đã đưa ra về trạng thái phía máy chủ và triển khai logic cần thiết để xác minh rằng những giả định này được đáp ứng. Điều này bao gồm việc đảm bảo rằng giá trị của bất kỳ đầu vào nào đều hợp lý trước khi tiếp tục.

Điều quan trọng nữa là phải đảm bảo rằng cả nhà phát triển và người thử nghiệm đều có thể hiểu đầy đủ các giả định này và cách ứng dụng sẽ phản ứng trong các tình huống khác nhau. Điều này có thể giúp nhóm phát hiện ra các lỗi logic càng sớm càng tốt. Để tạo điều kiện thuận lợi cho việc này, nhóm phát triển nên tuân thủ các phương pháp hay nhất sau đây bất cứ khi nào có thể:

- Duy trì các tài liệu thiết kế và luồng dữ liệu rõ ràng cho tất cả các giao dịch và quy trình công việc, lưu ý mọi giả định được đưa ra ở mỗi giai đoạn.
- Viết mã càng rõ ràng càng tốt. Nếu khó hiểu điều gì sẽ xảy ra thì sẽ khó phát hiện ra bất kỳ sai sót logic nào. Lý tưởng nhất là mã được viết tốt không cần tài liệu để hiểu nó. Trong những trường hợp phức tạp không thể tránh khỏi, việc tạo ra tài liệu rõ ràng là rất quan trọng để đảm bảo rằng các nhà phát triển và người thử nghiệm khác biết những giả định nào đang được đưa ra và chính xác hành vi dự kiến ​​là gì.
- Lưu ý mọi tham chiếu đến mã khác sử dụng từng thành phần. Hãy suy nghĩ về bất kỳ tác dụng phụ nào của những phần phụ thuộc này nếu một bên độc hại thao túng chúng theo cách bất thường.
