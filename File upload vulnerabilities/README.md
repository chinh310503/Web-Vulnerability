# File upload vulnerabilities

## Lỗ hổng tải lên tập tin là gì

Lỗ hổng tải tệp lên là khi máy chủ web cho phép người dùng tải tệp lên hệ thống tệp của mình mà không xác thực đầy đủ các thông tin như tên, loại, nội dung hoặc kích thước. Không thực thi đúng các hạn chế này có thể có nghĩa là ngay cả một chức năng tải hình ảnh cơ bản cũng có thể được sử dụng để tải lên các tệp tùy ý và có khả năng gây nguy hiểm. Điều này thậm chí có thể bao gồm các tệp tập lệnh phía máy chủ cho phép thực thi mã từ xa.

Trong một số trường hợp, bản thân hành động tải tệp lên đã đủ gây ra thiệt hại. Các cuộc tấn công khác có thể liên quan đến yêu cầu HTTP tiếp theo đối với tệp, thường là để kích hoạt quá trình thực thi tệp của máy chủ.

## Tác động của lỗ hổng tải lên tập tin

Tác động của lỗ hổng tải lên tệp thường phụ thuộc vào hai yếu tố chính:

- Trang web không xác thực đúng khía cạnh nào của tệp, có thể là kích thước, loại, nội dung, v.v.
- Những hạn chế nào được áp dụng đối với tệp sau khi nó được tải lên thành công.

Trong trường hợp xấu nhất, loại tệp không được xác thực đúng cách và cấu hình máy chủ cho phép một số loại tệp nhất định (chẳng hạn như .phpvà .jsp) được thực thi dưới dạng mã. Trong trường hợp này, kẻ tấn công có thể tải lên tệp mã phía máy chủ có chức năng như một web shell, cấp cho chúng toàn quyền kiểm soát máy chủ.

Nếu tên tệp không được xác thực chính xác, điều này có thể cho phép kẻ tấn công ghi đè lên các tệp quan trọng chỉ bằng cách tải lên tệp có cùng tên. Nếu máy chủ cũng dễ bị tấn công bởi việc truyền tải thư mục, điều này có nghĩa là kẻ tấn công thậm chí có thể tải tệp lên các vị trí không lường trước được.

Việc không đảm bảo rằng kích thước của tệp nằm trong ngưỡng dự kiến ​​cũng có thể kích hoạt một dạng tấn công từ chối dịch vụ (DoS), theo đó kẻ tấn công sẽ lấp đầy dung lượng đĩa trống.

## Lỗ hổng tải lên tập tin phát sinh như thế nào

Với những mối nguy hiểm khá rõ ràng, rất hiếm khi các trang web ngoài tự nhiên không có bất kỳ hạn chế nào đối với những tệp mà người dùng được phép tải lên. Thông thường hơn, các nhà phát triển triển khai những gì họ tin là xác thực mạnh mẽ vốn có sai sót hoặc có thể dễ dàng bỏ qua.

Ví dụ, họ có thể cố gắng đưa các loại tệp nguy hiểm vào danh sách đen, nhưng không tính đến sự khác biệt trong phân tích cú pháp khi kiểm tra phần mở rộng tệp. Cũng như bất kỳ danh sách đen nào, cũng dễ vô tình bỏ sót các loại tệp ít được biết đến hơn nhưng vẫn có thể nguy hiểm.

Trong những trường hợp khác, trang web có thể thử kiểm tra loại tệp bằng cách xác minh các thuộc tính có thể dễ dàng bị kẻ tấn công thao túng bằng các công cụ như Burp Proxy hoặc Repeater.

Cuối cùng, ngay cả các biện pháp xác thực mạnh mẽ cũng có thể được áp dụng không nhất quán trên mạng máy chủ và thư mục hình thành nên trang web, dẫn đến những khác biệt có thể bị lợi dụng.

## Một số cách khai thác lỗ hổng tải tệp tin

- Ghi đè cấu hình máy chủ
- Làm xáo trộn phần mở rộng tập tin
- Xác thực nội dung của tệp bị lỗi
- Tải lên các tập lệnh phía máy khách độc hại
- Khai thác lỗ hổng trong việc phân tích các tệp đã tải lên
- Khai thác các điều kiện tải lên tệp

## Làm thế nào để ngăn chặn lỗ hổng tải tệp lên

Cho phép người dùng tải tệp lên là việc bình thường và không nhất thiết phải nguy hiểm miễn là bạn thực hiện đúng các biện pháp phòng ngừa. Nhìn chung, cách hiệu quả nhất để bảo vệ trang web của riêng bạn khỏi các lỗ hổng này là thực hiện tất cả các biện pháp sau:

- Kiểm tra phần mở rộng tệp dựa trên danh sách trắng các tiện ích mở rộng được phép thay vì danh sách đen các tiện ích mở rộng bị cấm. Việc đoán những tiện ích mở rộng nào bạn có thể muốn cho phép sẽ dễ dàng hơn nhiều so với việc đoán những tiện ích mở rộng nào mà kẻ tấn công có thể cố tải lên.
- Đảm bảo tên tệp không chứa bất kỳ chuỗi con nào có thể được hiểu là một thư mục hoặc một chuỗi truyền tải (` ../`).
- Đổi tên các tệp đã tải lên để tránh xung đột có thể khiến các tệp hiện có bị ghi đè.
- Không tải tệp lên hệ thống tệp cố định của máy chủ cho đến khi chúng được xác thực đầy đủ.
- Càng nhiều càng tốt, hãy sử dụng một khung đã được thiết lập để xử lý trước việc tải tệp lên thay vì cố gắng viết các cơ chế xác thực của riêng bạn.
